{% set company_logo = frappe.db.get_value("Company", doc.company, "company_logo") if doc.company else None %}
<style>
  .ta-container { font-size: 8pt; }
  .ta-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .ta-header .title { font-size: 12pt; font-weight: bold; letter-spacing: 0.4px; }
  .ta-logo { max-height: 42px; max-width: 130px; object-fit: contain; }
  .ta-table { width: 100%; border-collapse: collapse; margin-bottom: 6px; }
  .ta-table th, .ta-table td { border: 1px solid #ccc; padding: 3px; vertical-align: top; }
  .ta-table th { background: #f7f7f7; text-align: left; }
  .ta-signature { display: flex; justify-content: space-around; margin-top: 10px; gap: 12px; }
  .ta-signature .slot { width: 45%; text-align: center; }
  .ta-signature .label { font-weight: bold; margin-bottom: 24px; }
  .ta-signature .line { border-top: 1px solid #555; margin: 0 10px; padding-top: 2px; }
  .ta-meta { margin-bottom: 6px; }
  .ta-meta div { margin-bottom: 2px; }
  @media print {
    @page { margin: 10mm 8mm; }
  }
</style>

<div class="ta-container">
  <div class="ta-header">
    <div>
      {% if company_logo %}
        <img class="ta-logo" src="{{ company_logo }}">
      {% endif %}
    </div>
    <div style="text-align:right">
      <div class="title">Aplikasi Transfer Dana</div>
      <div><strong>No Dokumen:</strong> {{ doc.name }}</div>
      <div><strong>Tanggal:</strong> {{ frappe.utils.format_date(doc.posting_date) }}</div>
      <div><strong>Perusahaan:</strong> {{ doc.company }}</div>
    </div>
  </div>

  <div class="ta-meta">
    <div><strong>Diminta Transfer:</strong> {{ frappe.utils.format_date(doc.requested_transfer_date) }}</div>
    {% if doc.reference_doctype and doc.reference_name %}
      <div><strong>Referensi:</strong> {{ doc.reference_doctype }} {{ doc.reference_name }}</div>
    {% endif %}
    <div><strong>Metode Transfer:</strong> {{ doc.transfer_method or "-" }}</div>
    <div><strong>Status:</strong> {{ doc.status or doc.workflow_state }}</div>
  </div>

  <table class="ta-table">
    <tr>
      <th style="width:40%">Penerima</th>
      <th style="width:30%">Bank</th>
      <th style="width:30%">Rekening</th>
    </tr>
    <tr>
      <td>
        <div><strong>Nama:</strong> {{ doc.beneficiary_name }}</div>
        <div><strong>Jenis:</strong> {{ doc.payee_type }}</div>
      </td>
      <td>
        <div><strong>Bank:</strong> {{ doc.bank_name }}</div>
        <div><strong>Cabang:</strong> {{ doc.bank_branch or '-' }}</div>
      </td>
      <td>
        <div><strong>No Rekening:</strong> {{ doc.account_number }}</div>
        <div><strong>Atas Nama:</strong> {{ doc.account_holder_name or '-' }}</div>
      </td>
    </tr>
  </table>

  <table class="ta-table">
    <tr>
      <th style="width:10%">No</th>
      <th style="width:50%">Deskripsi</th>
      <th style="width:20%">Jumlah</th>
      <th style="width:20%">Jumlah Diharapkan</th>
    </tr>
    {% if doc.items %}
      {% for item in doc.items %}
      <tr>
        <td style="text-align:center">{{ loop.index }}</td>
        <td>
          {{ item.description }}
          {% if item.reference_doctype and item.reference_name %}
            <br><small style="color:#666">(Ref: {{ item.reference_doctype }} {{ item.reference_name }})</small>
          {% endif %}
        </td>
        <td style="text-align:right">{{ frappe.utils.fmt_money(item.amount, currency=doc.currency) }}</td>
        <td style="text-align:right">{{ frappe.utils.fmt_money(item.expected_amount or item.amount, currency=doc.currency) }}</td>
      </tr>
      {% endfor %}
      <tr style="font-weight:bold; background:#f0f0f0">
        <td colspan="2" style="text-align:right">TOTAL</td>
        <td style="text-align:right">{{ frappe.utils.fmt_money(doc.amount, currency=doc.currency) }}</td>
        <td style="text-align:right">{{ frappe.utils.fmt_money(doc.expected_amount, currency=doc.currency) }}</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="4" style="text-align:center; color:#999; padding:20px">Belum ada item ditambahkan</td>
      </tr>
    {% endif %}
  </table>

  <table class="ta-table">
    <tr>
      <th style="width:50%">Ringkasan</th>
      <th style="width:50%">Keterangan</th>
    </tr>
    <tr>
      <td>
        <div><strong>Total Nilai:</strong> {{ frappe.utils.fmt_money(doc.amount, currency=doc.currency) }}</div>
        <div><strong>Terbilang:</strong> {{ doc.amount_in_words }}</div>
      </td>
      <td>
        <div><strong>Tujuan Transfer:</strong></div>
        <div style="white-space:pre-wrap; min-height:48px;">{{ doc.transfer_purpose }}</div>
        {% if doc.bank_reference_hint %}
          <div><strong>Petunjuk Referensi Bank:</strong> {{ doc.bank_reference_hint }}</div>
        {% endif %}
      </td>
    </tr>
  </table>

  <table class="ta-table">
    <tr>
      <th style="width:50%">Jejak Pembayaran</th>
      <th style="width:50%">Catatan</th>
    </tr>
    <tr>
      <td>
        <div><strong>Payment Entry:</strong> {{ doc.payment_entry or '-' }}</div>
        <div><strong>Tanggal Bayar:</strong> {{ frappe.utils.format_date(doc.paid_date) if doc.paid_date else '-' }}</div>
        <div><strong>Jumlah Dibayar:</strong> {{ frappe.utils.fmt_money(doc.paid_amount, currency=doc.currency) if doc.paid_amount else '-' }}</div>
      </td>
      <td>
        <div><strong>Status Workflow:</strong> {{ doc.workflow_state or '-' }}</div>
        <div><strong>Dicetak oleh:</strong> {{ doc.printed_by or '-' }}</div>
        <div><strong>Tanggal Cetak:</strong> {{ frappe.utils.format_datetime(doc.printed_at) if doc.printed_at else '-' }}</div>
        {% if doc.created_by_user %}
        <div><strong>Dibuat oleh:</strong> {{ doc.created_by_user }}</div>
        {% endif %}
        {% if doc.submit_on %}
        <div><strong>Submit On:</strong> {{ frappe.utils.format_datetime(doc.submit_on) }}</div>
        {% endif %}
      </td>
    </tr>
  </table>

  <div class="ta-signature">
    <div class="slot">
      <div class="label">{{ doc.signatory_1_label or 'Disetujui Oleh' }}</div>
      <div class="line"></div>
      <div>{{ doc.signatory_1_name or '&nbsp;' }}</div>
      <div style="color:#666">{{ doc.signatory_1_title or '&nbsp;' }}</div>
    </div>
    <div class="slot">
      <div class="label">{{ doc.signatory_2_label or 'Disetujui Oleh' }}</div>
      <div class="line"></div>
      <div>{{ doc.signatory_2_name or '&nbsp;' }}</div>
      <div style="color:#666">{{ doc.signatory_2_title or '&nbsp;' }}</div>
    </div>
  </div>
</div>
